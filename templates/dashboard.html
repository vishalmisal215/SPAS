{% extends "base.html" %}

{% block content %}
<!-- HOME SECTION -->
<section id="section-home" class="dashboard-section active">
    <div class="hero hero-small">
        <h1>Welcome, {{ user.full_name }}!!</h1>
        <p>Select a section from the menu to navigate</p>
    </div>
</section>

<!-- PROFILE SECTION -->
<section id="section-profile" class="dashboard-section">
    <div class="card card-tilt">
        <h2>My Profile</h2>
        
        <div id="profile-info" class="profile-info">
            <p><strong>Roll Number:</strong> {{ user.roll_no }}</p>
            <p><strong>Full Name:</strong> {{ user.full_name }}</p>
            <p><strong>Branch:</strong> {{ user.branch }}</p>
            <p><strong>Year:</strong> {{ user.year }}</p>
            <p><strong>Email:</strong> {{ user.email }}</p>
            <button id="edit-profile-btn" class="btn btn-primary">Edit Profile</button>
        </div>
        
        <div id="profile-form" style="display: none;">
            <form method="post" action="{{ url_for('update_profile') }}">
                <label>Roll Number</label>
                <input type="text" value="{{ user.roll_no }}" disabled>
                <label>Full Name</label>
                <input type="text" name="full_name" value="{{ user.full_name }}" required>
                <label>Branch</label>
                <select name="branch" required>
                    <option value="CSE" {% if user.branch == 'CM' %}selected{% endif %}>CM</option>
                    <option value="IT" {% if user.branch == 'IT' %}selected{% endif %}>IT</option>
                    <option value="ECE" {% if user.branch == 'ECE' %}selected{% endif %}>ECE</option>
                    <option value="ME" {% if user.branch == 'ME' %}selected{% endif %}>ME</option>
                    <option value="Civil" {% if user.branch == 'Civil' %}selected{% endif %}>Civil</option>
                </select>
                <label>Year</label>
                <select name="year" required>
                    <option value="1st" {% if user.year == '1st' %}selected{% endif %}>1st</option>
                    <option value="2nd" {% if user.year == '2nd' %}selected{% endif %}>2nd</option>
                    <option value="3rd" {% if user.year == '3rd' %}selected{% endif %}>3rd</option>
                    
                </select>
                <label>Email</label>
                <input type="email" name="email" value="{{ user.email }}" required>
                <div style="margin-top: 15px; display: flex; gap: 10px;">
                    <button type="submit" class="btn btn-primary">Save Changes</button>
                    <button type="button" id="cancel-edit-btn" class="btn btn-secondary">Cancel</button>
                </div>
            </form>
        </div>
        
        <div style="margin-top: 40px; padding-top: 30px; border-top: 3px solid #e0e0e0;">
            <h3 style="color: #c62828; margin-bottom: 10px;">Danger Zone</h3>
            <p style="color: #666; font-size: 14px; margin-bottom: 15px; line-height: 1.6;">
                Deleting your account is <strong>permanent and cannot be undone</strong>. 
                All your exam results and data will be permanently deleted.
            </p>
            <button onclick="confirmDeleteAccount()" class="btn" style="background: #c62828; color: white; border: 2px solid #c62828;">
                Delete My Account
            </button>
        </div>
    </div>
</section>

<script>
function confirmDeleteAccount() {
    if (confirm('WARNING: This will permanently delete your account and ALL your exam data. This action CANNOT be undone!\n\nAre you absolutely sure?')) {
        if (confirm('FINAL CONFIRMATION: Delete account permanently?')) {
            const form = document.createElement('form');
            form.method = 'POST';
            form.action = '/delete_account';
            document.body.appendChild(form);
            form.submit();
        }
    }
}
</script>

<!-- INSTRUCTIONS SECTION -->
<section id="section-instructions" class="dashboard-section">
    <div class="card card-tilt compact-card">
        <h2>Exam Instructions</h2>
        <ul class="compact-list">
            <li><strong>Total Questions:</strong> 20 multiple choice questions randomly selected</li>
            <li><strong>Duration:</strong> 30 minutes (timer will be displayed at the top)</li>
            <li><strong>Marking:</strong> Each correct answer carries 1 mark</li>
            <li><strong>Attempt:</strong> You can attempt all or selected questions</li>
            <li><strong>Submission:</strong> Click "Submit Exam" button only when you're sure</li>
            <li><strong>Auto-submit:</strong> Exam will auto-submit when time runs out</li>
            <li><strong>Result:</strong> You will see your result immediately after submission</li>
            <li><strong>One Attempt:</strong> Each practical can only be submitted once</li>
            <li><strong>View Results:</strong> Click on submitted practical to view your result</li>
        </ul>
        <div style="margin-top: 20px; padding: 15px; background: #fff3cd; border-left: 4px solid #ffc107; border-radius: 6px;">
            <strong>Important:</strong> Make sure you have a stable internet connection before starting the exam.
        </div>
    </div>
</section>

<!-- PRACTICAL LIST SECTION -->
<section id="section-practicals" class="dashboard-section">
    <div class="card card-tilt">
        <h2>Practical List</h2>
        
        <div style="margin-bottom: 20px; padding: 15px; background: #e3f2fd; border-radius: 8px;">
            <label style="font-weight: 600; margin-right: 10px; color: #1976d2;">Select Subject:</label>
            <select id="subjectSelect" onchange="changeSubject(this.value)" style="padding: 10px 20px; border: 2px solid #1976d2; border-radius: 6px; font-size: 15px; background: white; cursor: pointer; min-width: 220px;">
                {% for subject in subjects %}
                <option value="{{ subject.name }}" {% if selected_subject == subject.name %}selected{% endif %}>{{ subject.name }}</option>
                {% endfor %}
            </select>
        </div>
        
        <p style="margin-bottom: 15px; color: #666;">
            Select a practical to start exam or click submitted practical to view result
        </p>
        
        <ul class="practical-list" id="practical-list">
            {% for practical in practicals %}
            <li class="practical-item {% if practical in submitted_practicals %}practical-submitted{% endif %}" data-value="{{ practical }}">
                <div>
                    <span class="practical-name">{{ practical }}</span>
                    {% if practical in submitted_practicals %}
                    <br>
                    <span class="submitted-badge">‚úì Submitted</span>
                    {% endif %}
                </div>
                {% if practical in submitted_practicals %}
                    <a href="{{ url_for('view_result', practical_name=practical) }}" class="view-result-btn">View Result</a>
                {% else %}
                    <span class="start-btn" onclick="startExam('{{ practical }}')">Start Exam</span>
                {% endif %}
            </li>
            {% else %}
            <li style="text-align: center; color: #666;">No practicals available yet</li>
            {% endfor %}
        </ul>
        
        <form method="post" id="start-exam-form" style="display: none;">
            <input type="hidden" name="practical_name" id="selected-practical">
        </form>
    </div>
</section>

<!-- RULES SECTION -->
<section id="section-rules" class="dashboard-section">
    <div class="card card-tilt compact-card">
        <h2>Exam Rules</h2>
        <ul class="compact-list">
            <li><strong>No Tab Switching:</strong> Switching tabs/windows during exam is strictly prohibited</li>
            <li><strong>No Refresh:</strong> Do not refresh the page during the exam</li>
            <li><strong>Single Device:</strong> Use only one device and one browser at a time</li>
            <li><strong>Copy-Paste Disabled:</strong> Ctrl+C, Ctrl+V, and right-click are disabled during exam</li>
            <li><strong>Timer:</strong> Keep an eye on the timer - exam auto-submits when time expires</li>
            <li><strong>One Submission Only:</strong> Once submitted, you cannot retake the same practical</li>
            <li><strong>Honest Attempt:</strong> Answer questions on your own without external help</li>
        </ul>
        <div style="margin-top: 20px; padding: 15px; background: #ffebee; border-left: 4px solid #f44336; border-radius: 6px;">
            <strong>Warning:</strong> Violation of any exam rule may result in automatic submission and disciplinary action.
        </div>
    </div>
</section>

<!-- ABOUT US SECTION -->
<section id="section-about" class="dashboard-section">
    <div class="card">
        <div style="text-align: center; margin-bottom: 35px;">
            <h2 style="font-size: 28px; color: #1976d2; margin-bottom: 8px;">About Us</h2>
            <p style="color: #666; font-size: 15px;">Meet the team behind the Student Practical Assessment System</p>
            <div style="width: 60px; height: 4px; background: linear-gradient(135deg, #1976d2, #42a5f5); border-radius: 2px; margin: 12px auto 0;"></div>
        </div>

        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 25px; justify-items: center;">

            <!-- Member 1: Janhavi Nandan -->
            <div style="text-align: center; background: linear-gradient(135deg, #fce4ec, #fff); border-radius: 16px; padding: 25px 20px; box-shadow: 0 4px 15px rgba(233,30,99,0.1); border: 2px solid #f8bbd0; width: 100%; max-width: 200px; transition: transform 0.2s;" onmouseover="this.style.transform='translateY(-5px)'" onmouseout="this.style.transform='translateY(0)'">
                <div style="width: 85px; height: 85px; border-radius: 50%; background: #fce4ec; border: 3px solid #e91e63; display: flex; align-items: center; justify-content: center; margin: 0 auto 15px; font-size: 48px;">üë©‚Äçüíª</div>
                <h4 style="margin: 0 0 5px; color: #333; font-size: 15px;">Janhavi Nandan</h4>
                <span style="display: inline-block; background: #e91e63; color: white; padding: 3px 12px; border-radius: 20px; font-size: 11px; font-weight: 600;">Developer</span>
            </div>

            <!-- Member 2: Vishal Misal -->
            <div style="text-align: center; background: linear-gradient(135deg, #e8eaf6, #fff); border-radius: 16px; padding: 25px 20px; box-shadow: 0 4px 15px rgba(63,81,181,0.1); border: 2px solid #9acee6; width: 100%; max-width: 200px; transition: transform 0.2s;" onmouseover="this.style.transform='translateY(-5px)'" onmouseout="this.style.transform='translateY(0)'">
                <div style="width: 85px; height: 85px; border-radius: 50%; background: #e8eaf6; border: 3px solid #3fadb5; display: flex; align-items: center; justify-content: center; margin: 0 auto 15px; font-size: 48px;">üë®‚Äçüíª</div>
                <h4 style="margin: 0 0 5px; color: #333; font-size: 15px;">Vishal Misal</h4>
                <span style="display: inline-block; background: #09cfe6; color: white; padding: 3px 12px; border-radius: 20px; font-size: 11px; font-weight: 600;">Developer</span>
            </div>

            <!-- Member 3: Kunal Patil -->
            <div style="text-align: center; background: linear-gradient(135deg, #e3f2fd, #fff); border-radius: 16px; padding: 25px 20px; box-shadow: 0 4px 15px rgba(25,118,210,0.1); border: 2px solid #bbdefb; width: 100%; max-width: 200px; transition: transform 0.2s;" onmouseover="this.style.transform='translateY(-5px)'" onmouseout="this.style.transform='translateY(0)'">
                <div style="width: 85px; height: 85px; border-radius: 50%; background: #e3f2fd; border: 3px solid #1976d2; display: flex; align-items: center; justify-content: center; margin: 0 auto 15px; font-size: 48px;">üë®‚Äçüíº</div>
                <h4 style="margin: 0 0 5px; color: #333; font-size: 15px;">Kunal Patil</h4>
                <span style="display: inline-block; background: #1976d2; color: white; padding: 3px 12px; border-radius: 20px; font-size: 11px; font-weight: 600;">Team Member</span>
            </div>

            <!-- Member 4: Dhiraj Patil -->
            <div style="text-align: center; background: linear-gradient(135deg, #e3f2fd, #fff); border-radius: 16px; padding: 25px 20px; box-shadow: 0 4px 15px rgba(25,118,210,0.1); border: 2px solid #bbdefb; width: 100%; max-width: 200px; transition: transform 0.2s;" onmouseover="this.style.transform='translateY(-5px)'" onmouseout="this.style.transform='translateY(0)'">
                <div style="width: 85px; height: 85px; border-radius: 50%; background: #e3f2fd; border: 3px solid #1976d2; display: flex; align-items: center; justify-content: center; margin: 0 auto 15px; font-size: 48px;">üë®‚Äçüíº</div>
                <h4 style="margin: 0 0 5px; color: #333; font-size: 15px;">Dhiraj Patil</h4>
                <span style="display: inline-block; background: #1976d2; color: white; padding: 3px 12px; border-radius: 20px; font-size: 11px; font-weight: 600;">Team Member</span>
            </div>

            <!-- Member 5: Mansi Patil -->
            <div style="text-align: center; background: linear-gradient(135deg, #fce4ec, #fff); border-radius: 16px; padding: 25px 20px; box-shadow: 0 4px 15px rgba(233,30,99,0.1); border: 2px solid #f8bbd0; width: 100%; max-width: 200px; transition: transform 0.2s;" onmouseover="this.style.transform='translateY(-5px)'" onmouseout="this.style.transform='translateY(0)'">
                <div style="width: 85px; height: 85px; border-radius: 50%; background: #fce4ec; border: 3px solid #e91e63; display: flex; align-items: center; justify-content: center; margin: 0 auto 15px; font-size: 48px;">üë©‚Äçüíº</div>
                <h4 style="margin: 0 0 5px; color: #333; font-size: 15px;">Mansi Patil</h4>
                <span style="display: inline-block; background: #e91e63; color: white; padding: 3px 12px; border-radius: 20px; font-size: 11px; font-weight: 600;">Team Member</span>
            </div>

            <!-- Member 6: Rakshanda Kakade -->
            <div style="text-align: center; background: linear-gradient(135deg, #fce4ec, #fff); border-radius: 16px; padding: 25px 20px; box-shadow: 0 4px 15px rgba(233,30,99,0.1); border: 2px solid #f8bbd0; width: 100%; max-width: 200px; transition: transform 0.2s;" onmouseover="this.style.transform='translateY(-5px)'" onmouseout="this.style.transform='translateY(0)'">
                <div style="width: 85px; height: 85px; border-radius: 50%; background: #fce4ec; border: 3px solid #e91e63; display: flex; align-items: center; justify-content: center; margin: 0 auto 15px; font-size: 48px;">üë©‚Äçüíº</div>
                <h4 style="margin: 0 0 5px; color: #333; font-size: 15px;">Rakshanda Kakade</h4>
                <span style="display: inline-block; background: #e91e63; color: white; padding: 3px 12px; border-radius: 20px; font-size: 11px; font-weight: 600;">Team Member</span>
            </div>

        </div>

        <div style="text-align: center; margin-top: 35px; padding: 20px; background: linear-gradient(135deg, #e3f2fd, #fce4ec); border-radius: 12px;">
            <p style="color: #555; font-size: 14px; margin: 0;">
                üéì <strong>SPAS</strong> ‚ÄîStudent Practical Assessment System<br>
                <span style="font-size: 13px; color: #777;">Built with dedication by our team ¬© 2026</span>
            </p>
        </div>
    </div>
</section>

<script>
    /* ‚îÄ‚îÄ Subject persistence via localStorage ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
    var SUBJECT_KEY = 'sopes_selected_subject';

    function changeSubject(value) {
        // Save to localStorage so it persists across reloads/navigation
        try { localStorage.setItem(SUBJECT_KEY, value); } catch(e) {}
        window.location.href = '?subject=' + encodeURIComponent(value);
    }

    document.addEventListener('DOMContentLoaded', function() {
        var urlParams  = new URLSearchParams(window.location.search);
        var urlSubject = urlParams.get('subject');
        var sel        = document.getElementById('subjectSelect');

        if (!urlSubject && sel) {
            // No subject in URL ‚Äî restore from localStorage
            var saved = '';
            try { saved = localStorage.getItem(SUBJECT_KEY) || ''; } catch(e) {}
            if (saved) {
                // Check if saved subject exists as an option
                var found = false;
                for (var i = 0; i < sel.options.length; i++) {
                    if (sel.options[i].value === saved) { found = true; break; }
                }
                if (found) {
                    window.location.replace('?subject=' + encodeURIComponent(saved));
                    return;
                }
            }
        } else if (urlSubject && sel) {
            // URL has subject ‚Äî save it to localStorage
            try { localStorage.setItem(SUBJECT_KEY, urlSubject); } catch(e) {}
        }

        // ‚îÄ‚îÄ Inject About Us nav button ‚îÄ‚îÄ
        const navMenu = document.querySelector('.hamburger-menu') || document.querySelector('.nav-menu') || document.querySelector('nav');
        if (navMenu) {
            const logoutLink = navMenu.querySelector('a[href*="logout"]');
            if (logoutLink) {
                const aboutBtn = document.createElement('button');
                aboutBtn.className = 'nav-link nav-btn';
                aboutBtn.setAttribute('data-target', 'section-about');
                aboutBtn.textContent = 'About Us';
                navMenu.insertBefore(aboutBtn, logoutLink);
            }
        }
    });

    function startExam(practicalName) {
        // Preserve current subject in the form POST so dashboard redirects back correctly
        var sel = document.getElementById('subjectSelect');
        var subject = sel ? sel.value : '';
        try { if (subject) localStorage.setItem(SUBJECT_KEY, subject); } catch(e) {}
        const form  = document.getElementById('start-exam-form');
        const input = document.getElementById('selected-practical');
        input.value = practicalName;
        form.submit();
    }
</script>

{% endblock %}